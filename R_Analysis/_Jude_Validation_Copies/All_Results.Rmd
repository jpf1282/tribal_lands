---
title: "All Results"
author: "Jude Bayham"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: html_document
---

```{r setup, include = FALSE}

knitr::opts_chunk$set(echo = TRUE)
options(scipen=999)

```

# Setup
Install these packages if neccessary.
```{r project_setup, message = FALSE, warning = FALSE, include=FALSE}

library(readr)
library(gamlss)
library(tidyr)
library(knitr)
library(DT)
library(dplyr)
library(purrr)
library(stringr)
library(scales)
library(broom)
library(ggplot2)
library(ggbeeswarm)
library(MASS)
library(pscl)
library(boot)
library(nlme)
library(cplm)
library(conflicted)
library(fixest)
library(sjPlot)
library(stargazer)
library(clubSandwich)

conflict_prefer("filter", "dplyr")
conflict_prefer("select", "dplyr")

load("../final_data.Rdata")


#Function to coerce fixest object into stargazer table
fixest_to_coeftest <- function(fixest.object,ds){
  require(fixest)
  #Check if arg1 is fixest class
  if(!class(fixest.object)=="fixest"){
    stop("Not a fixest object")
  }
  
  #Extract the coefficient table
  df <- fixest.object$coeftable 
  
  if(length(fixest.object$obsRemoved)>0){
    cluster.var <- ds$tribe[-fixest.object$obsRemoved]
  } else {
    cluster.var <- ds$tribe
  }
  
  
  df.mod <- df %>%
    mutate(se = as.numeric(sqrt(diag(vcov(fixest.object,cluster=cluster.var)))),
           stat = Estimate/se,
           p = 2*pt(-abs(stat),df=nobs(fixest.object)-fixest.object$nparams)) %>%
    dplyr::select(Estimate,se,stat,p)
  
  
  #Coerce dataframe into matrix
  coeftest.object <- as.matrix(df.mod)
  
  #Capture variable names from df and rename columns to conform to coeftest
  new_names <- list(rownames(df),
                    c("Estimate","Std. Error","t value","Pr(>|t|)"))
  
  #Assign names
  dimnames(coeftest.object) <- new_names
  
  #re-class to coeftest
  class(coeftest.object) <- 'coeftest'
  
  return(coeftest.object)
  
}

#Function to coerce lme object into stargazer table
lme_to_coeftest <- function(lme.object){
  require(clubSandwich)
  #Check if arg1 is fixest class
  if(!class(lme.object)=="lme"){
    stop("Not an lme object")
  }
  
  #Extract the coefficient table
  df <- coef_test(lme.object,
                  vcov = vcovCR(lme.object,
                                type="CR2"))
  
  #Coerce dataframe into matrix
  coeftest.object <- as.matrix(df[,c(1,2,3,5)])
  
  #Capture variable names from df and rename columns to conform to coeftest
  new_names <- list(rownames(df),
                    c("Estimate","Std. Error","t value","Pr(>|t|)"))
  
  #Assign names
  dimnames(coeftest.object) <- new_names
  
  #re-class to coeftest
  class(coeftest.object) <- 'coeftest'
  
  return(coeftest.object)
  
}

gamlss_clustered_vcov <- function(gamlss.object,cluster=NA){
  require(gamlss)
  # if(is.na(cluster)){
  #   #set cluster to be index
  #   #fc <- index(gamlss.object$mu.x)
  # } else {
  #   #check length conforms
  #   if(!length(cluster)==length(gamlss.object$y)){
  #     stop("Clustering vector provided does not conform; check if there are NAs dropped in estimation.")
  #   }
  # }
  esample <- as.numeric(rownames(as.matrix(gamlss.object$mu.qr$qr)))
  fc <- cluster  #isolates the groups used in estimation
  
  # Calculates the new Meat portion of our covariance matrix
  m <- length(unique(fc))
  k <- length(gamlss.object$mu.coefficients)
  u <- gamlss.object$mu.qr$qr
  u.clust <- matrix(NA, nrow=m, ncol=k)
  for(j in 1:k){
    u.clust[,j] <- tapply(u[,j], as.numeric(fc), sum)
  }
  u.clust <- u.clust[!rowSums(u.clust,dims = 1)==0,] #dropping all clusters with all zeros
  cl.vcov <- vcov(gamlss.object)[1:k,1:k]%*%( t(u.clust) %*% (u.clust))%*%vcov(gamlss.object)[1:k,1:k]
  return(cl.vcov)
}




#Constructing datasets
data_long <- distinct(merged_data_record_all_long, tribe, time, FIPS, .keep_all = TRUE) %>%
  ungroup() %>%
  mutate(tribe = factor(tribe),
         time = factor(time)) 

data_t1and2_long <- filter(data_long, tribe %in% tribes_time1and2_lst$tribe)

#Constructing weights
data_long <- data_long %>%
  group_by(tribe,time) %>%
  summarise(wgt=1/n()) %>%
  ungroup() %>%
  left_join(data_long,
            .,
            by=c("tribe","time"))

data_t1and2_long <- data_t1and2_long %>%
  group_by(tribe,time) %>%
  summarise(wgt=1/n()) %>%
  ungroup() %>%
  left_join(data_t1and2_long,
            .,
            by=c("tribe","time"))
  
```



The objective of this supplement is to provide detail on the analysis of CCE characteristics in the historical and present-day time periods.  We begin by detailing the methods used to compare the CCEs across time followed by an investigation of the climate, mineral access, and proximity to federal lands.



# Methods

Overview of technical details of dataset construction.... 


We employ several statistical methods to test whether characteristics of the historical lands differ from the present-day lands.  We focus on land characteristics that are either durable over long time periods or not directly impacted by the human inhabitants of the land.  We divide the characteristics into categories: climate, mineral resource access, and national lands. The set of climate characteristics consist of number of days the temperature exceeds 100 degrees Farenheit, the Palmer Drought Severity Index (PDSI) over ???, annual precipitation over ???, and a measure of wildfire hazard potential.  The set of mineral resource access characteristics include an indicator for whether a CCE lies over an oil or gas basin, the annual quantity of oil production, the annual quantity of natural gas production, and the number of oil and gas wells in a CCE.  Finally, we assess the proximity of historical and present-day CCEs to federal lands.

Our primary method to compare the historical and present-day CCEs is a linear regression of the characteristic as a function of a binary indicator for present-day lands (and an intercept), which amounts to simple ANOVA test of whether the means are equal in the historical and present-day CCEs.  All statistical tests are conducted using cluster-robust standard errors which account for heteroskedasticity and serial correlation that may exist within a tribe due to the proximity of CCEs within a tribe's range.

We assess the robustness of our estimate using alternative model specifications based on the statistical properties of the variable being analyzed.  We estimate a weighted regression model that effectively places equal weight on each tribe given the number of CCEs varies with the historical range of the tribe.  Larger, more dominant, or tribes with CCEs in the Eastern US tend to include more CCEs, which effectively increases the weight on those tribes in a simple regression setting.  We also estimate the models with tribe fixed-effects and random-effects to account for potential trends common across historical and present-day lands within a tribe. 




# CCEs Inhabited

We compare the spatial extent of tribe's historical and present-day areas as measured by the number of CCEs.  We estimate the difference between the number of CCEs reported as historical lands and the number of CCEs reported as present-day lands using several regression models to assess the robustness of the relationship.  Column 1 shows the results of an ordinary least squares regression based on the subset of tribes that inhabited more than one CCE in both the historical and present.  Column 2 estimates a similar model using the same data, but observations are inversely weighted to the number of CCEs inhabited by each tribe.  Since tribes vary in their size and spatial extent, a standard OLS model places more weight on the impact to larger tribes because they represent more observations in the dataset.  Therefore, Model 2 reweights the data to place equal weight on each tribe rather than the population as a whole.  Columns 3 and 4 replicate specifications in columns 1 and 2, respectively, except they include all observations including tribes that have only observations in either the historical or present-day periods.  Column 5 estimates a similar specification using a Poisson regression model.


```{r CCE, message = FALSE, warning = FALSE, echo = FALSE, results='asis'}
model.shell <- vector("list",5)
dep.var <- "n_unique_FIPS"

model.shell[[1]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_t1and2_long) %>%
  fixest_to_coeftest(.,data_t1and2_long)
                          
model.shell[[2]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_t1and2_long,
                          weights = ~ wgt) %>%
  fixest_to_coeftest(.,data_t1and2_long)

model.shell[[3]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_long) %>%
  fixest_to_coeftest(.,data_long)
                          
model.shell[[4]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_long,
                          weights = ~ wgt) %>%
  fixest_to_coeftest(.,data_long)

model.shell[[5]] <- feglm(formula(str_c(dep.var, " ~ time")),
                          data = data_t1and2_long,
                          family = "poisson") %>%
  fixest_to_coeftest(.,data_t1and2_long)


stargazer(model.shell,type="html",
          ci=T,
          intercept.top = T,
          intercept.bottom = F,
          dep.var.caption = "Dependent Variable: Number of CCEs",
          column.labels = c("OLS","Weighted OLS","OLS","Weighted OLS","Poisson"),
          model.numbers = T,
          covariate.labels = c("Historical (Intercept)","Present-day Change"),
          title = "Table S1: Extent of Area Occupied",
          add.lines = list(c("Obs","8,165","8,165","10,528","10,528","8,165")),
          notes = c("95% confidence intervals in parentheses.",
                    "All inference is based on tribe-clustered standard errors, which are robust to serial correlation and heteroskedasticity."))
```

The results indicate that tribes occupied far fewer CCEs in the present period relative to the historical period.  The results in column 1 suggest that tribes occupied an average of 146.7 CCEs during the historical period. By the present day, the average number of CCEs fell by 136.303 (a `r percent(1-(model.shell[[1]][1,1]+model.shell[[1]][2,1])/model.shell[[1]][1,1])` reduction).  The relationship is robust to all specifications.  However, the results of column 2 (weighted OLS) indicate that the abolute estimated effect is heavily influenced by large tribes, yet the percentage reduction in CCEs is of similar magnitude (`r percent(1-(model.shell[[2]][1,1]+model.shell[[2]][2,1])/model.shell[[2]][1,1])`). 



# Changes in Historical and Present-Day CCE Characteristics  



## Climate Variables

We analyze the difference between climate variables in the pre-migration lands to the post-migration lands.  We focus on heat index, drought, annual precipitation, and wildfire hazard potential.

### Heat

We begin with the heat index, which represents the number of days per year that a CCE exceeded 100 degrees F. 

```{r, message = FALSE, warning = FALSE, echo = FALSE}


ggplot(data_long, aes(time, h_100_hist, colour = time)) +
  geom_boxplot() +
  geom_quasirandom(alpha = 1/10, varwidth = TRUE) +
  theme_minimal()


ggplot(data_t1and2_long, aes(time, h_100_hist, colour = time)) +
  geom_boxplot() +
  geom_quasirandom(alpha = 1/10, varwidth = TRUE) +
  theme_minimal()

```



```{r heat, message = FALSE, warning = FALSE, echo = FALSE, results='asis'}
model.shell <- vector("list",5)
dep.var <- "h_100_hist"

model.shell[[1]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_t1and2_long) %>%
  fixest_to_coeftest(.,data_t1and2_long)
                          
model.shell[[2]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_t1and2_long,
                          weights = ~ wgt) %>%
  fixest_to_coeftest(.,data_t1and2_long)

model.shell[[3]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_long) %>%
  fixest_to_coeftest(.,data_long)
                          
model.shell[[4]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_long,
                          weights = ~ wgt) %>%
  fixest_to_coeftest(.,data_long)

model.shell[[5]] <- feglm(formula(str_c(dep.var, " ~ time")),
                          data = data_t1and2_long,
                          family = "poisson") %>%
  fixest_to_coeftest(.,data_t1and2_long)


stargazer(model.shell,type="html",
          ci=T,
          intercept.top = T,
          intercept.bottom = F,
          dep.var.caption = "Dependent Variable: Days/Year in excess of 100 degrees F",
          column.labels = c("OLS","Weighted OLS","OLS","Weighted OLS","Poisson"),
          model.numbers = T,
          covariate.labels = c("Historical (Intercept)","Present-day Change"),
          add.lines = list(c("Obs","8,165","8,165","10,528","10,528","8,165")),
          title = "Table S2: Extreme Heat",
          notes = c("95% confidence intervals in parentheses.",
                    "All inference is based on tribe-clustered standard errors, which are robust to serial correlation and heteroskedasticity."))
```

The first column of Table S2 presents the results of an OLS regression of heat day CCEs on a dummy variable indicating present-day areas.  We estimate the same alternative specifications that were used in Table S1 to assess robustness of the relationship.  We find a robust relationship indicating that present-day lands experience more days of extreme heat compared to historical lands.

## Drought

We use the Palmer Drought Severity Index (PDSI) to assess exposure to drought.  Specifically, we compare the median PDSI of present-day to historical lands.  Note that negative values indicate more drought whereas positive values indicate wetter conditions.

```{r, message = FALSE, warning = FALSE, echo = FALSE}




ggplot(data_t1and2_long, aes(time, drt_median, colour = time)) +
  geom_boxplot(varwidth = T) +
  geom_quasirandom(alpha = 1/10, varwidth = TRUE) +
  scale_y_reverse(breaks = seq(-1.5,1,by=.5), labels = c("More Drought -1.5","-1.0","-0.5","0","0.5","Less Drought 1.0")) +
  scale_colour_manual(values = c('#E0E022','#ff0000'),aesthetics = c("colour", "fill")) +
  theme_minimal() +
  xlab("") +
  ylab("") +
  scale_x_discrete(labels = c("time 1" = "Historical",
                              "time 2" = "Present-day")) +
  theme(legend.position = "none") 

```





```{r drought, message = FALSE, warning = FALSE, echo = FALSE, results='asis'}
model.shell <- vector("list",5)
dep.var <- "drt_median"

model.shell[[1]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_t1and2_long) %>%
  fixest_to_coeftest(.,data_t1and2_long)
                          
model.shell[[2]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_t1and2_long,
                          weights = ~ wgt) %>%
  fixest_to_coeftest(.,data_t1and2_long)

model.shell[[3]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_long) %>%
  fixest_to_coeftest(.,data_long)
                          
model.shell[[4]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_long,
                          weights = ~ wgt) %>%
  fixest_to_coeftest(.,data_long)

model.shell[[5]] <- feols(formula(str_c(dep.var, " ~ time | tribe")),
                          data = data_t1and2_long) %>%
  fixest_to_coeftest(.,data_t1and2_long)


stargazer(model.shell,type="html",
          ci=T,
          intercept.top = T,
          intercept.bottom = F,
          dep.var.caption = "Dependent Variable: Median PDSI",
          column.labels = c("OLS","Weighted OLS","OLS","Weighted OLS","Tribe FE OLS"),
          model.numbers = T,
          covariate.labels = c("Historical (Intercept)","Present-day Change"),
          add.lines = list(c("Obs","8,165","8,165","10,528","10,528","8,165")),
          title = "Table S3: Drought",
          notes = c("95% confidence intervals in parentheses.",
                    "All inference is based on tribe-clustered standard errors, which are robust to serial correlation and heteroskedasticity."))
```


The results indicate fairly robust evidence that present-day lands experience more drought than historical CCEs.  Columns 1-4 present the results of the unweighted (1 and 3) and weighted OLS (2 and 4) regressions using only tribes represented in the historical and present day (1 and 2) and all observations (3 and 4).   The mean PDSI on the historical lands ranges from -0.164 to -0.423.  Four of the five models indicate more drought on present-day lands.  The weighted OLS regression using all data (column 4) has a positive coefficient on present-day.  However, the intercept is considerable lower, which indicates that some tribes that do not appear in both periods have strong influence over the estimate.



## Precipitation

We compare the mean annual precipitation (mm) in present-day and historical CCEs.

```{r, message = FALSE, warning = FALSE, echo = FALSE}


ggplot(data_long, aes(time, precip, colour = time)) +
  geom_boxplot() +
  geom_quasirandom(alpha = 1/10, varwidth = TRUE) +
  theme_minimal()


ggplot(data_t1and2_long, aes(time, precip, colour = time)) +
  geom_boxplot() +
  geom_quasirandom(alpha = 1/10, varwidth = TRUE) +
  theme_minimal()

```


We report that the difference between historical and present-day lands are statistically indistinguishable.  We estimate the same models as described in Table S3 to assess the robustness of this result.

```{r precip, message = FALSE, warning = FALSE, echo = FALSE, results='asis'}
model.shell <- vector("list",5)
dep.var <- "precip"

model.shell[[1]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_t1and2_long) %>%
  fixest_to_coeftest(.,data_t1and2_long)
                          
model.shell[[2]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_t1and2_long,
                          weights = ~ wgt) %>%
  fixest_to_coeftest(.,data_t1and2_long)

model.shell[[3]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_long) %>%
  fixest_to_coeftest(.,data_long)
                          
model.shell[[4]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_long,
                          weights = ~ wgt) %>%
  fixest_to_coeftest(.,data_long)

model.shell[[5]] <- feols(formula(str_c(dep.var, " ~ time | tribe")),
                          data = data_t1and2_long) %>%
  fixest_to_coeftest(.,data_t1and2_long)


stargazer(model.shell,type="html",
          ci=T,
          intercept.top = T,
          intercept.bottom = F,
          dep.var.caption = "Dependent Variable: Mean Annual Precipitation (mm)",
          column.labels = c("OLS","Weighted OLS","OLS","Weighted OLS","Tribe FE OLS"),
          model.numbers = T,
          covariate.labels = c("Historical (Intercept)","Present-day Change"),
          add.lines = list(c("Obs","8,165","8,165","10,528","10,528","8,165")),
          title = "Table S4: Precipitation",
          notes = c("95% confidence intervals in parentheses.",
                    "All inference is based on tribe-clustered standard errors, which are robust to serial correlation and heteroskedasticity."))
```

While the evidence for a difference in precipitation across the present-day and historical CCEs is weak, the weighted OLS regressions indicate that the present-day lands experience slightly more precipitation.  This result suggests that there exists a large amount of variation across tribes, and that there are some tribes that occupied more CCEs that experienced less precipitation on some of the lands.


## Wildfire Hazard Potential

We compare mean wildfire hazard potential rating of all cells within a CCE boundary in the present-day and historical lands.  Figure ?? suggests that the present-day lands have a higher wildfire hazard potential.  Table S5 generally confirms that present-day lands have higher wildfire hazard potential compared to historical lands.

```{r, message = FALSE, warning = FALSE, echo = FALSE}


ggplot(data_long, aes(time, fire_mean, colour = time)) +
  geom_boxplot() +
  geom_quasirandom(alpha = 1/10, varwidth = TRUE) +
  theme_minimal()


ggplot(data_t1and2_long, aes(time, fire_mean, colour = time)) +
  geom_boxplot() +
  geom_quasirandom(alpha = 1/10, varwidth = TRUE) +
  scale_colour_manual(values = c('#32CD32','#ff0000'),aesthetics = c("colour", "fill")) +
  theme_minimal() +
  xlab("") +
  ylab("") +
  scale_x_discrete(labels = c("time 1" = "Historical",
                              "time 2" = "Present-day")) +
  theme(legend.position = "none") 
  

```
Figure caption: Wildfire hazard potential in historical and present-day CCEs.  While indigenous people were concentrated on fewer total CCEs (width of distribution), the mean WHP is higher in the present-day CCEs than the historical.

```{r fire_median, message = FALSE, warning = FALSE, echo = FALSE, results='asis'}

dep.var <- "fire_mean"
model.shell <- vector("list",5)

model.shell[[1]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_t1and2_long) %>%
  fixest_to_coeftest(.,data_t1and2_long)
                          
model.shell[[2]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_t1and2_long,
                          weights = ~ wgt) %>%
  fixest_to_coeftest(.,data_t1and2_long)

model.shell[[3]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_long) %>%
  fixest_to_coeftest(.,data_long)
                          
model.shell[[4]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_long,
                          weights = ~ wgt) %>%
  fixest_to_coeftest(.,data_long)

model.shell[[5]] <- feols(formula(str_c(dep.var, " ~ time | tribe")),
                          data = data_t1and2_long) %>%
  fixest_to_coeftest(.,data_t1and2_long)


stargazer(model.shell,type="html",
          ci=T,
          intercept.top = T,
          intercept.bottom = F,
          dep.var.caption = "Dependent Variable: Mean Wildfire Hazard Potential",
          column.labels = c("OLS","Weighted OLS","OLS","Weighted OLS","Tribe FE OLS"),
          model.numbers = T,
          covariate.labels = c("Historical (Intercept)","Present-day Change"),
          add.lines = list(c("Obs","8,165","8,165","10,528","10,528","8,165")),
          title = "Table S5: Wildfire Hazard Potential",
          notes = c("95% confidence intervals in parentheses.",
                    "All inference is based on tribe-clustered standard errors, which are robust to serial correlation and heteroskedasticity."))
```

We assess the robustness of the comparison with the same battery of alterntive specifications.  While the weighted OLS models (columns 2 and 4) cast some doubt on the relationship, the other models suggest that present-day lands have significantly higher wildfire hazard potential. 


# Oil and Gas

## Oil and Gas Basins

We evaluate access to oil and gas based on the likelihood that a tribe's CCEs lie over subsurface oil and gas.  Our main specification, OLS, in Table S6 (column 1) indicates that present-day lands are less likely to have access to subsurface oil and gas.  Estimating OLS with a binary dependent variable is known as a linear probability model (LPM).  The LPM has two well-known shortcomings: 1) bias when the mass of the distribution lies outside of the unit interval, and 2) heteroskedasticity.  Since we estimate all models with robust standard errors, we should correct for heteroskedasticity.  We estimate a logistic regression (column 5) to assess the robustness of the difference between present-day and historical lands.  The results of the logistic regression indicate that present-day lands have less access to oil and gas supporting the results of our main specification.  However, the results of the weighted OLS (column 2) and the models using all data (columns 3 and 4) are less clear.  


```{r og_basin, message = FALSE, warning = FALSE, echo = FALSE, results='asis'}

dep.var <- "og_basin"
model.shell <- vector("list",5)

model.shell[[1]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_t1and2_long) %>%
  fixest_to_coeftest(.,data_t1and2_long)
                          
model.shell[[2]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_t1and2_long,
                          weights = ~ wgt) %>%
  fixest_to_coeftest(.,data_t1and2_long)

model.shell[[3]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_long) %>%
  fixest_to_coeftest(.,data_long)
                          
model.shell[[4]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_long,
                          weights = ~ wgt) %>%
  fixest_to_coeftest(.,data_long)

model.shell[[5]] <- feglm(formula(str_c(dep.var, " ~ time")),
                          data = data_t1and2_long,
                          family = binomial) %>%
  fixest_to_coeftest(.,data_t1and2_long)


stargazer(model.shell,type="html",
          ci=T,
          intercept.top = T,
          intercept.bottom = F,
          dep.var.caption = "Dependent Variable: Presence of Subsurface Oil and Gas",
          column.labels = c("OLS","Weighted OLS","OLS","Weighted OLS","Logit"),
          model.numbers = T,
          covariate.labels = c("Historical (Intercept)","Present-day Change"),
          add.lines = list(c("Obs","8,165","8,165","10,528","10,528","8,165")),
          title = "Table S6: Oil and Gas Basin",
          notes = c("95% confidence intervals in parentheses.",
                    "All inference is based on tribe-clustered standard errors, which are robust to serial correlation and heteroskedasticity."))

```


## Oil

Oil production

The distributions are highly skewed.

```{r oil_avg, message = FALSE, warning = FALSE, echo = FALSE, results='asis'}

dep.var <- "oil_avg"
model.shell <- vector("list",5)
data_t1and2_long$oil_avg <-  data_t1and2_long$oil_avg/1000000
data_long$oil_avg <-  data_long$oil_avg/1000000

model.shell[[1]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_t1and2_long) %>%
  fixest_to_coeftest(.,data_t1and2_long)
                          
model.shell[[2]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_t1and2_long,
                          weights = ~ wgt) %>%
  fixest_to_coeftest(.,data_t1and2_long)

model.shell[[3]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_long) %>%
  fixest_to_coeftest(.,data_long)
                          
model.shell[[4]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_long,
                          weights = ~ wgt) %>%
  fixest_to_coeftest(.,data_long)

model.shell[[5]] <- feols(formula(str_c(dep.var, " ~ time | tribe")),
                          data = data_t1and2_long) %>%
  fixest_to_coeftest(.,data_t1and2_long)


stargazer(model.shell,type="text",
          ci=T,
          intercept.top = T,
          intercept.bottom = F,
          dep.var.caption = "Dependent Variable: Oil Production (millions of barrels)",
          column.labels = c("OLS","Weighted OLS","OLS","Weighted OLS","Tribe FE OLS"),
          model.numbers = T,
          covariate.labels = c("Historical (Intercept)","Present-day Change"),
          add.lines = list(c("Obs","8,165","8,165","10,528","10,528","8,165")),
          title = "Table S7: Oil Production",
          notes = c("95% confidence intervals in parentheses.",
                    "All inference is based on tribe-clustered standard errors, which are robust to serial correlation and heteroskedasticity."))

```

## Gas

Gas production



```{r gas_avg, message = FALSE, warning = FALSE, echo = FALSE, results='asis'}

dep.var <- "gas_avg"
model.shell <- vector("list",5)
data_t1and2_long$gas_avg <-  data_t1and2_long$gas_avg/1000000
data_long$gas_avg <-  data_long$gas_avg/1000000

model.shell[[1]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_t1and2_long) %>%
  fixest_to_coeftest(.,data_t1and2_long)
                          
model.shell[[2]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_t1and2_long,
                          weights = ~ wgt) %>%
  fixest_to_coeftest(.,data_t1and2_long)

model.shell[[3]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_long) %>%
  fixest_to_coeftest(.,data_long)
                          
model.shell[[4]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_long,
                          weights = ~ wgt) %>%
  fixest_to_coeftest(.,data_long)

model.shell[[5]] <- feols(formula(str_c(dep.var, " ~ time | tribe")),
                          data = data_t1and2_long) %>%
  fixest_to_coeftest(.,data_t1and2_long)


stargazer(model.shell,type="text",
          ci=T,
          intercept.top = T,
          intercept.bottom = F,
          dep.var.caption = "Dependent Variable: Presence of Subsurface Oil and Gas",
          column.labels = c("OLS","Weighted OLS","OLS","Weighted OLS","Tribe FE OLS"),
          model.numbers = T,
          covariate.labels = c("Historical (Intercept)","Present-day Change"),
          add.lines = list(c("Obs","8,165","8,165","10,528","10,528","8,165")),
          title = "Table S8: Gas Production",
          notes = c("95% confidence intervals in parentheses.",
                    "All inference is based on tribe-clustered standard errors, which are robust to serial correlation and heteroskedasticity."))

```



## Oil and Gas Wells



```{r og_well_count, message = FALSE, warning = FALSE, echo = FALSE, results='asis'}

dep.var <- "og_well_count"
model.shell <- vector("list",5)

model.shell[[1]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_t1and2_long) %>%
  fixest_to_coeftest(.,data_t1and2_long)
                          
model.shell[[2]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_t1and2_long,
                          weights = ~ wgt) %>%
  fixest_to_coeftest(.,data_t1and2_long)

model.shell[[3]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_long) %>%
  fixest_to_coeftest(.,data_long)
                          
model.shell[[4]] <- feols(formula(str_c(dep.var, " ~ time")),
                          data = data_long,
                          weights = ~ wgt) %>%
  fixest_to_coeftest(.,data_long)

model.shell[[5]] <- feols(formula(str_c(dep.var, " ~ time | tribe")),
                          data = data_t1and2_long) %>%
  fixest_to_coeftest(.,data_t1and2_long)


stargazer(model.shell,type="text",
          ci=T,
          intercept.top = T,
          intercept.bottom = F,
          dep.var.caption = "Dependent Variable: Presence of Subsurface Oil and Gas",
          column.labels = c("OLS","Weighted OLS","OLS","Weighted OLS","Tribe FE OLS"),
          model.numbers = T,
          covariate.labels = c("Historical (Intercept)","Present-day Change"),
          add.lines = list(c("Obs","8,165","8,165","10,528","10,528","8,165")),
          title = "Table S8: Oil and Gas Wells",
          notes = c("95% confidence intervals in parentheses.",
                    "All inference is based on tribe-clustered standard errors, which are robust to serial correlation and heteroskedasticity."))
```




# Federal Lands


```{r, message = FALSE, warning = FALSE, echo = FALSE}


ggplot(data_long, aes(time, p_all, colour = time)) +
  geom_boxplot() +
  geom_quasirandom(alpha = 1/10, varwidth = TRUE) +
  theme_minimal()


ggplot(data_t1and2_long, aes(time, p_all, colour = time)) +
  geom_boxplot() +
  geom_quasirandom(alpha = 1/10, varwidth = TRUE) +
  theme_minimal()

```


```{r p_all, message = FALSE, warning = FALSE, echo = FALSE}

bezi_data <- mutate(data_t1and2_long, 
                    p_all = ifelse(p_all >= 1, .99999, p_all)) %>%
  filter(!is.na(p_all)) %>%
  dplyr::select(time, tribe, p_all,wgt)

bezi_model <- gamlss(p_all ~ time, family = BEZI, data = bezi_data, trace = F)

bezi_model_w <-  gamlss(p_all ~ time, family = BEZI, data = bezi_data, trace = F,weights = wgt)

tab_model(bezi_model,bezi_model_w)

t2.se <- sqrt(diag(gamlss_clustered_vcov(bezi_model,cluster = bezi_data$tribe)))
t2.se.w <- sqrt(diag(gamlss_clustered_vcov(bezi_model_w,cluster = bezi_data$tribe)))

t2.ci <- exp(c(coef(bezi_model)[2] - 1.96*t2.se[2],coef(bezi_model)[2] + 1.96*t2.se[2]))
t2.ci.w <- exp(c(coef(bezi_model_w)[2] - 1.96*t2.se.w[2],coef(bezi_model_w)[2] + 1.96*t2.se.w[2]))

```
